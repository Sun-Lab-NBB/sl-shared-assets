from pathlib import Path
from dataclasses import field, dataclass

import polars as pl
from ataraxis_data_structures import YamlConfig

from .session_data import SessionTypes as SessionTypes
from ..configuration import AcquisitionSystems as AcquisitionSystems

@dataclass(frozen=True)
class SessionMetadata:
    session: str
    animal: str

@dataclass
class DatasetTrackingData:
    tracking_data_path: Path = ...
    def resolve_paths(self, root_directory_path: Path) -> None: ...
    def make_directories(self) -> None: ...

@dataclass
class DatasetSessionData:
    session_path: Path = ...
    data_path: Path = ...
    metadata_path: Path = ...
    data: pl.DataFrame | None = ...
    metadata: pl.DataFrame | None = ...
    def resolve_paths(self, session_directory: Path) -> None: ...
    def make_directories(self) -> None: ...
    def load_data(self) -> None: ...
    def release_data(self) -> None: ...

@dataclass
class DatasetData(YamlConfig):
    name: str
    project: str
    session_type: str | SessionTypes
    acquisition_system: str | AcquisitionSystems
    sessions: tuple[SessionMetadata, ...] = field(default_factory=tuple)
    tracking_data: DatasetTrackingData = field(default_factory=DatasetTrackingData)
    dataset_data_path: Path = field(default_factory=Path)
    _session_data_cache: dict[str, DatasetSessionData] = field(default_factory=dict, repr=False)
    def __post_init__(self) -> None: ...
    @classmethod
    def create(
        cls,
        name: str,
        project: str,
        session_type: SessionTypes | str,
        acquisition_system: AcquisitionSystems | str,
        sessions: tuple[SessionMetadata, ...] | set[SessionMetadata],
        datasets_root: Path,
    ) -> DatasetData: ...
    @classmethod
    def load(cls, dataset_path: Path) -> DatasetData: ...
    def save(self) -> None: ...
    @property
    def animals(self) -> tuple[str, ...]: ...
    def get_sessions_for_animal(self, animal: str) -> tuple[SessionMetadata, ...]: ...
    def get_session_data(self, animal: str, session: str) -> DatasetSessionData: ...
